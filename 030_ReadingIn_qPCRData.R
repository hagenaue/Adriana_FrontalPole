#Reading in qPCR data:


#########################


setwd("~/Documents/Microarray Gen/FrontalPole/Sample_MetaData")


#Decoders were made with the following info:

#The original decoding file ("Barcode Order Form.xlsx") needed to be reformatted:
#From Adriana: Cards 1-36 are the first set (GABA glutamate) and have 4 samples per card, then the duplicate for each sample is in the next card. For example sample 1 is on card 1 and card 2.
#Cards 39 to 58 are the Dopamine/Serotonin, those have 8 samples per card then the duplicates for those samples are in the following card. There are no cards 37 or 38. 
#Also, samples 11, 35, and 36 did not work on the extraction RNA process so they were redone and relabeled as samples 73, 74, and 75.

#In the folder for each card, the raw CT values are in the spreadsheet called Results. The wells that did not amplify would say No Amp or Undetermined instead of a CT number. 
#Samples 27 and 38 were the ones that had a whole stem of wells not amplified (meaning one of the duplicates didn't work).

Decoder_GabaGluCards<-read.csv("Decoder_FrontalPole_GabaGlu_Cards.csv", header=T, stringsAsFactors = F)
str(Decoder_GabaGluCards)

# 'data.frame':	144 obs. of  5 variables:
#   $ Subject.Number       : int  5000 5000 5313 5313 2169 2169 4087 4087 5066 5066 ...
# $ ID                   : int  1 1 2 2 3 3 4 4 5 5 ...
# $ Folder               : chr  "Card 1.eds" "Card 2.eds" "Card 1.eds" "Card 2.eds" ...
# $ SampleNumber         : int  1 1 2 2 3 3 4 4 1 1 ...
# $ QC_AmplificationIssue: chr  "N" "N" "N" "N" ...

Decoder_GabaGluCards$ID<-as.character(Decoder_GabaGluCards$ID)

Decoder_DA5HTCards<-read.csv("Decoder_FrontalPole_DA5HT_Cards.csv", header=T, stringsAsFactors = F)
str(Decoder_DA5HTCards)

# 'data.frame':	144 obs. of  5 variables:
#   $ Subject.Number       : int  5000 5000 5313 5313 2169 2169 4087 4087 5066 5066 ...
# $ ID                   : int  1 1 2 2 3 3 4 4 5 5 ...
# $ Folder               : logi  NA NA NA NA NA NA ...
# $ SampleNumber         : logi  NA NA NA NA NA NA ...
# $ QC_AmplificationIssue: chr  "N" "N" "N" "N" ...

Decoder_DA5HTCards$ID<-as.character(Decoder_DA5HTCards$ID)

#Note: I don't have the folder entered for this one or sample number because it didn't follow the same predictable order as the GabaGlu Cards (which is probably good)
#Later, it turned out that some of the predicted folders for the GabaGlu cards ended up not quite being correct either.


#***********************************

#Reading in the individual results files for the GabaGlu dataset:


#We need to loop over all folders in the directory and grab the results file from within each folder.

setwd("~/Documents/Microarray Gen/FrontalPole/PCR")

foldernames<-cbind(list.files(), list.files(full.names=T))
str(foldernames)
#chr [1:56, 1:2] "Card 1.eds" "Card 10.eds" "Card 11.eds" "Card 12.eds" "Card 13.eds" "Card 14.eds" "Card 15.eds" "Card 16.eds" "Card 17.eds" ...

head(foldernames)
# [,1]          [,2]           
# [1,] "Card 1.eds"  "./Card 1.eds" 
# [2,] "Card 10.eds" "./Card 10.eds"
# [3,] "Card 11.eds" "./Card 11.eds"
# [4,] "Card 12.eds" "./Card 12.eds"
# [5,] "Card 13.eds" "./Card 13.eds"
# [6,] "Card 14.eds" "./Card 14.eds"

setwd(foldernames[1,2])
list.files()
#[1] "Amplification Data.csv" "Plate QC.csv"           "Results.csv"  

setwd("~/Documents/Microarray Gen/FrontalPole/Sample_MetaData")

write.csv(foldernames, "PCR_foldernames.csv")
#I quickly annotated this with the biological pathway targeted by each card, and then read it back in:

foldernames<-read.csv("PCR_foldernames_annotated.csv", header=T, stringsAsFactors = F)
str(foldernames)

# 'data.frame':	56 obs. of  4 variables:
#   $ X              : int  1 2 3 4 5 6 7 8 9 10 ...
# $ FileName       : chr  "Card 1.eds" "Card 10.eds" "Card 11.eds" "Card 12.eds" ...
# $ FolderPath     : chr  "./Card 1.eds" "./Card 10.eds" "./Card 11.eds" "./Card 12.eds" ...
# $ TargetedBiology: chr  "GabaGlu" "GabaGlu" "GabaGlu" "GabaGlu" ...

foldernames_GabaGlu<-foldernames[foldernames$TargetedBiology=="GabaGlu",]
foldernames_DA5HT<-foldernames[foldernames$TargetedBiology=="DA5HT",]

setwd("~/Documents/Microarray Gen/FrontalPole/PCR")
setwd(foldernames_GabaGlu$FolderPath[1])

#We need to ignore the first 5 rows when reading in data.
temp<-read.table("Results.csv", sep=",", skip=5, header=T, stringsAsFactors = F)
str(temp)

temp$Card<-rep(foldernames_GabaGlu$FileName[1], length(temp[,1]))

str(temp) 

#Let's use that as the start for the df:
Concatenated_GabaGlu<-temp
rm(temp) 

#Cool, that seems to work.


for(i in c(2:length(foldernames_GabaGlu$FileName))){
  setwd("~/Documents/Microarray Gen/FrontalPole/PCR")
  setwd(foldernames_GabaGlu$FolderPath[i])
  print(getwd())
  
  temp<-read.table("Results.csv", sep=",", skip=5, header=T, stringsAsFactors = F)
  temp$Card<-rep(foldernames_GabaGlu$FileName[i], length(temp[,1]))
  
  Concatenated_GabaGlu<-rbind.data.frame(Concatenated_GabaGlu, temp)
  rm(temp)
  
}

# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 10.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 11.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 12.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 13.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 14.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 15.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 16.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 17.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 18.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 19.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 2.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 20.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 21.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 22.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 23.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 24.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 25.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 26.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 27.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 28.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 29.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 3.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 30.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 31.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 32.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 33.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 34.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 35.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 36.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 4.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 5.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 6.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 7.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 8.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 9.eds"

str(Concatenated_GabaGlu)
# 'data.frame':	13824 obs. of  24 variables:
#   $ Well                       : chr  "A1" "A2" "A3" "A4" ...
# $ Sample.Name                : chr  "No Sample" "1" "1" "1" ...
# $ Target.Name                : chr  "ABAT-Hs00609436_m1" "ADCY7-Hs00936808_m1" "ADORA1-Hs00379752_m1" "ADORA2A-Hs00169123_m1" ...
# $ Amp.Score                  : num  1.28 1.25 1.14 1.23 1.23 ...
# $ Amp.Status                 : chr  "Amp" "Amp" "Amp" "Amp" ...
# $ Task                       : chr  "UNKNOWN" "UNKNOWN" "UNKNOWN" "UNKNOWN" ...
# $ Cq                         : chr  "20.513" "25.734" "23.737" "27.270" ...
# $ Cq.Mean                    : chr  "20.513" "25.734" "23.737" "27.27" ...
# $ Cq.Standard.Deviation      : chr  "-" "-" "-" "-" ...
# $ Quantity                   : chr  "-" "-" "-" "-" ...
# $ Quantity.Mean              : chr  "-" "-" "-" "-" ...
# $ Quantity.Standard.Deviation: chr  "-" "-" "-" "-" ...
# $ Intercept                  : chr  "-" "-" "-" "-" ...
# $ R.Squared                  : chr  "-" "-" "-" "-" ...
# $ Slope                      : chr  "-" "-" "-" "-" ...
# $ Efficiency                 : chr  "-" "-" "-" "-" ...
# $ Auto.Threshold             : chr  "true" "true" "true" "true" ...
# $ Threshold                  : num  0.183 0.161 0.09 0.175 0.133 0.193 0.14 0.106 0.195 0.136 ...
# $ Auto.Baseline              : chr  "true" "true" "true" "true" ...
# $ Baseline.Start             : num  3 3 3 3 3 3 3 3 3 3 ...
# $ Baseline.End               : num  15 20 19 22 18 17 19 19 16 19 ...
# $ Omit                       : chr  "false" "false" "false" "false" ...
# $ X                          : logi  NA NA NA NA NA NA ...
# $ Card                       : chr  "Card 1.eds" "Card 1.eds" "Card 1.eds" "Card 1.eds" ...

#Doing some quick sanity checks to make sure everything read in properly:

table(Concatenated_GabaGlu$Card)

# Card 1.eds Card 10.eds Card 11.eds Card 12.eds Card 13.eds Card 14.eds Card 15.eds Card 16.eds Card 17.eds Card 18.eds Card 19.eds  Card 2.eds 
# 384         384         384         384         384         384         384         384         384         384         384         384 
# Card 20.eds Card 21.eds Card 22.eds Card 23.eds Card 24.eds Card 25.eds Card 26.eds Card 27.eds Card 28.eds Card 29.eds  Card 3.eds Card 30.eds 
# 384         384         384         384         384         384         384         384         384         384         384         384 
# Card 31.eds Card 32.eds Card 33.eds Card 34.eds Card 35.eds Card 36.eds  Card 4.eds  Card 5.eds  Card 6.eds  Card 7.eds  Card 8.eds  Card 9.eds 
# 384         384         384         384         384         384         384         384         384         384         384         384 

table(Concatenated_GabaGlu$Sample.Name)
# 1        10        12        13        14        15        16        17        18        19         2        20        21        22        23 
# 190       192       192       190       192       192       192       190       192       192       192       192       190       192       192 
# 24        25        26        27        28        29         3        30        31        32        33        34        37        38        39 
# 192       190       192       192       192       190       192       192       192       192       190       192       190       192       192 
# 4        40        41        42        43        44        45        46        47        48        49         5        50        51        52 
# 192       192       190       192       192       192       190       192       192       192       190       190       192       192       192 
# 53        54        55        56        57        58        59         6        60        61        62        63        64        65        66 
# 190       192       192       192       190       192       192       192       192       190       192       192       192       190       192 
# 67        68        69         7        70        71        72        73        74        75         8         9 No Sample 
# 192       192       190       192       192       192       192       192       192       192       192       190        36 

#Hmmm... I wonder why there are different #'s of rows of data for different samples (190-192 samples)

HowManyMeasurementsPerSample<-table(Concatenated_GabaGlu$Card, Concatenated_GabaGlu$Sample.Name)

HowManyMeasurementsPerSample
# 1 10 12 13 14 15 16 17 18 19  2 20 21 22 23 24 25 26 27 28 29  3 30 31 32 33 34 37 38 39  4 40 41 42 43 44 45 46 47 48 49  5 50 51 52 53
# Card 1.eds  95  0  0  0  0  0  0  0  0  0 96  0  0  0  0  0  0  0  0  0  0 96  0  0  0  0  0  0  0  0 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 10.eds  0  0  0  0  0  0  0 95 96 96  0 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 11.eds  0  0  0  0  0  0  0  0  0  0  0  0 95 96 96 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 12.eds  0  0  0  0  0  0  0  0  0  0  0  0 95 96 96 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 13.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 95 96 96 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 14.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 95 96 96 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 15.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 95  0 96 96 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 16.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 95  0 96 96 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 17.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 95 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 18.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 95 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 19.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 95 96 96  0 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 2.eds  95  0  0  0  0  0  0  0  0  0 96  0  0  0  0  0  0  0  0  0  0 96  0  0  0  0  0  0  0  0 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 20.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 95 96 96  0 96  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# 
# 54 55 56 57 58 59  6 60 61 62 63 64 65 66 67 68 69  7 70 71 72 73 74 75  8  9 No Sample
# Card 1.eds   0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1
# Card 10.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1
# Card 11.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1
# Card 12.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1
# Card 13.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1
# Card 14.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1
# Card 15.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1
# Card 16.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1
# Card 17.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 96 96  0  0         1
# Card 18.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 96 96  0  0         1
# Card 19.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1
# Card 2.eds   0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1
# Card 20.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0         1


setwd("~/Documents/Microarray Gen/FrontalPole/Output")
write.csv(HowManyMeasurementsPerSample, "HowManyMeasurementsPerSample.csv")

#Looks like some samples have 95 measurements and some have 96. Huh. 
#perhaps the header is being included in the rbind?
#Alright, it looks like the first sample on each card is missing 1 row of data. Maybe I have skip set too high.
#Nope - the problem is in the original results spreadsheets. The first row of data is always labeled "No Sample" but appears to actually be the measurement for gene "ABAT" for the first sample in the dataset.
#I asked Adriana about it - she says that it is a labeling error... so how do we fix it easily?  Let's grab the label from one row beneath it...

sum(Concatenated_GabaGlu$Sample.Name=="No Sample")
#[1] 36

which(Concatenated_GabaGlu$Sample.Name=="No Sample")
which(Concatenated_GabaGlu$Sample.Name=="No Sample")+1

IndicesForCorrectedSampleIDs<-which(Concatenated_GabaGlu$Sample.Name=="No Sample")+1

Concatenated_GabaGlu$Sample.Name[IndicesForCorrectedSampleIDs]

Concatenated_GabaGlu$Sample.Name[Concatenated_GabaGlu$Sample.Name=="No Sample"]

Concatenated_GabaGlu$Sample.Name[Concatenated_GabaGlu$Sample.Name=="No Sample"]<-Concatenated_GabaGlu$Sample.Name[IndicesForCorrectedSampleIDs]

table(Concatenated_GabaGlu$Sample.Name)

# 1  10  12  13  14  15  16  17  18  19   2  20  21  22  23  24  25  26  27  28  29   3  30  31  32  33  34  37  38  39   4  40  41  42  43  44  45  46 
# 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 
# 47  48  49   5  50  51  52  53  54  55  56  57  58  59   6  60  61  62  63  64  65  66  67  68  69   7  70  71  72  73  74  75   8   9 
# 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 192 

#Fixed!

#Fixed. :)

HowManyMeasurementsPerSample<-table(Concatenated_GabaGlu$Card, Concatenated_GabaGlu$Sample.Name)

write.csv(HowManyMeasurementsPerSample, "HowManyMeasurementsPerSample_GabaGlu_Fixed.csv")


#****************************************

#Reading in the individual files for the DA5HT dataset:

setwd("~/Documents/Microarray Gen/FrontalPole/PCR")
setwd(foldernames_DA5HT$FolderPath[1])

#We need to ignore the first 5 rows when reading in data.
temp<-read.table("Results.csv", sep=",", skip=5, header=T, stringsAsFactors = F)
str(temp)

# 'data.frame':	384 obs. of  23 variables:
#   $ Well                       : chr  "A1" "A2" "A3" "A4" ...
# $ Sample.Name                : int  1 1 1 1 1 1 1 1 1 1 ...
# $ Target.Name                : chr  "ADRB1-Hs02330048_s1" "ADRB2-Hs00240532_s1" "COMT-Hs00241349_m1" "DBH-Hs01089840_m1" ...
# $ Amp.Score                  : num  1.25 1.38 1.09 1.31 1.42 ...
# $ Amp.Status                 : chr  "Amp" "Amp" "Amp" "Amp" ...
# $ Task                       : chr  "UNKNOWN" "UNKNOWN" "UNKNOWN" "UNKNOWN" ...
# $ Cq                         : chr  "24.245" "25.087" "24.579" "27.823" ...
# $ Cq.Mean                    : chr  "24.245" "25.087" "24.579" "27.823" ...
# $ Cq.Standard.Deviation      : chr  "-" "-" "-" "-" ...
# $ Quantity                   : chr  "-" "-" "-" "-" ...
# $ Quantity.Mean              : chr  "-" "-" "-" "-" ...
# $ Quantity.Standard.Deviation: chr  "-" "-" "-" "-" ...
# $ Intercept                  : chr  "-" "-" "-" "-" ...
# $ R.Squared                  : chr  "-" "-" "-" "-" ...
# $ Slope                      : chr  "-" "-" "-" "-" ...
# $ Efficiency                 : chr  "-" "-" "-" "-" ...
# $ Auto.Threshold             : chr  "true" "true" "true" "true" ...
# $ Threshold                  : num  0.163 0.239 0.048 0.167 0.24 0.202 0.227 0.194 0.184 0.228 ...
# $ Auto.Baseline              : chr  "true" "true" "true" "true" ...
# $ Baseline.Start             : num  3 3 3 3 3 3 3 3 3 3 ...
# $ Baseline.End               : num  19 20 21 23 27 20 23 27 27 21 ...
# $ Omit                       : chr  "false" "false" "false" "false" ...
# $ X                          : logi  NA NA NA NA NA NA ...

temp$Card<-rep(foldernames_DA5HT$FileName[1], length(temp[,1]))

str(temp) 

#Let's use that as the start for the df:
Concatenated_DA5HT<-temp
rm(temp)  
#Cool, that seems to work.


for(i in c(2:length(foldernames_DA5HT$FileName))){
  setwd("~/Documents/Microarray Gen/FrontalPole/PCR")
  setwd(foldernames_DA5HT$FolderPath[i])
  print(getwd())
  
  temp<-read.table("Results.csv", sep=",", skip=5, header=T, stringsAsFactors = F)
  temp$Card<-rep(foldernames_DA5HT$FileName[i], length(temp[,1]))
  
  Concatenated_DA5HT<-rbind.data.frame(Concatenated_DA5HT, temp)
  rm(temp)
  
}

# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 40.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 41.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 42.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 43.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 44.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 45.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 46.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 47.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 48.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 49.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 50.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 51.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 52.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 53.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 54.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 55.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 56.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 57.eds"
# [1] "/Users/mhh/Documents/Microarray Gen/FrontalPole/PCR/Card 58.eds"

str(Concatenated_DA5HT)

# 'data.frame':	7680 obs. of  24 variables:
#   $ Well                       : chr  "A1" "A2" "A3" "A4" ...
# $ Sample.Name                : int  1 1 1 1 1 1 1 1 1 1 ...
# $ Target.Name                : chr  "ADRB1-Hs02330048_s1" "ADRB2-Hs00240532_s1" "COMT-Hs00241349_m1" "DBH-Hs01089840_m1" ...
# $ Amp.Score                  : num  1.25 1.38 1.09 1.31 1.42 ...
# $ Amp.Status                 : chr  "Amp" "Amp" "Amp" "Amp" ...
# $ Task                       : chr  "UNKNOWN" "UNKNOWN" "UNKNOWN" "UNKNOWN" ...
# $ Cq                         : chr  "24.245" "25.087" "24.579" "27.823" ...
# $ Cq.Mean                    : chr  "24.245" "25.087" "24.579" "27.823" ...
# $ Cq.Standard.Deviation      : chr  "-" "-" "-" "-" ...
# $ Quantity                   : chr  "-" "-" "-" "-" ...
# $ Quantity.Mean              : chr  "-" "-" "-" "-" ...
# $ Quantity.Standard.Deviation: chr  "-" "-" "-" "-" ...
# $ Intercept                  : chr  "-" "-" "-" "-" ...
# $ R.Squared                  : chr  "-" "-" "-" "-" ...
# $ Slope                      : chr  "-" "-" "-" "-" ...
# $ Efficiency                 : chr  "-" "-" "-" "-" ...
# $ Auto.Threshold             : chr  "true" "true" "true" "true" ...
# $ Threshold                  : num  0.163 0.239 0.048 0.167 0.24 0.202 0.227 0.194 0.184 0.228 ...
# $ Auto.Baseline              : chr  "true" "true" "true" "true" ...
# $ Baseline.Start             : num  3 3 3 3 3 3 3 3 3 3 ...
# $ Baseline.End               : num  19 20 21 23 27 20 23 27 27 21 ...
# $ Omit                       : chr  "false" "false" "false" "false" ...
# $ X                          : logi  NA NA NA NA NA NA ...
# $ Card                       : chr  "Card 39.eds" "Card 39.eds" "Card 39.eds" "Card 39.eds" ...

#Doing some quick sanity checks:

table(Concatenated_DA5HT$Card)
# Card 39.eds Card 40.eds Card 41.eds Card 42.eds Card 43.eds Card 44.eds Card 45.eds Card 46.eds Card 47.eds Card 48.eds Card 49.eds Card 50.eds 
# 384         384         384         384         384         384         384         384         384         384         384         384 
# Card 51.eds Card 52.eds Card 53.eds Card 54.eds Card 55.eds Card 56.eds Card 57.eds Card 58.eds 
# 384         384         384         384         384         384         384         384 

table(Concatenated_DA5HT$Sample.Name)

# 1   2   3   4   5   6   7   8   9  10  12  13  14  15  16  17  18  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  37  38  39  40  41 
# 192  96  96  96  96  96  96  96  96  96  96  96  96  96  96  96 192  96  96  96 192  96  96  96  96  96  96  96  96 192  96  96  96  96  96  96  96 192 
# 42  43  44  45  46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72  73  74  75 
# 96  96  96  96 192  96  96  96  96  96  96  96  96  96  96  96 192  96  96 192  96  96  96  96  96  96  96  96  96  96  96  96  96  96 

#Several samples have 192 measurements: sample numbers 1, 18, 22, 31, 41, 46, 58, 61
#Why...?

table(Concatenated_DA5HT$Card, Concatenated_DA5HT$Sample.Name)

# 1  2  3  4  5  6  7  8  9 10 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 37 38 39 40 41 42 43 44 45 46 47 48 49
# Card 39.eds 48 48 48 48 48 48 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 40.eds 48 48 48 48 48 48 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 41.eds  0  0  0  0  0  0  0  0 48 48 48 48 48 48 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 42.eds  0  0  0  0  0  0  0  0 48 48 48 48 48 48 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 43.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 48 48 48 48 48 48 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 44.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 48 48 48 48 48 48 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 45.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 48 48 48 48 48 48 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 46.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 48 48 48 48 48 48 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 47.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 48 48 48 48 48 48 48 48  0  0  0  0  0  0
# Card 48.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 48 48 48 48 48 48 48 48  0  0  0  0  0  0
# Card 49.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 48 48 48 48 48 48
# Card 50.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 48 48 48 48 48 48
# Card 51.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# 
# 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75
# Card 39.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 40.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 41.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 42.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 43.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 44.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 45.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 46.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 47.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 48.eds  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 49.eds 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 50.eds 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# Card 51.eds  0  0 48 48 48 48 48 48 48 48  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
# [ reached getOption("max.print") -- omitted 7 rows ]

HowManyMeasurementsPerSample_DA5HT<-table(Concatenated_DA5HT$Card, Concatenated_DA5HT$Sample.Name)

setwd("~/Documents/Microarray Gen/FrontalPole/Output")
write.csv(HowManyMeasurementsPerSample_DA5HT, "HowManyMeasurementsPerSample_DA5HT.csv")

#most samples were run in duplicate (2 cards), but 8 samples (sample numbers 1, 18, 22, 31, 41, 46, 58, 61) were run in quadruplicate (4 cards), with cards 57 and 58 entirely composed of samples that had been run on other cards.

#I asked Adriana, and she says that she had two extra cards so she re-ran any samples that seemed like there could have been issues with pippetting/well-filling (without having seen the results). So hypothetically we could either use the later cards for those samples, or use all 4 quadruplicates if the data looks clean.


############################

#We need to take the name of the sample number and join it with the subject info:


#First, I changed the Sample.Name column to "ID" to make it match the sample info data.frame for later joining:
str(Concatenated_GabaGlu)
colnames(Concatenated_GabaGlu)[2]<-"ID"

str(Concatenated_DA5HT)
colnames(Concatenated_DA5HT)[2]<-"ID"
Concatenated_DA5HT$ID<-as.character(Concatenated_DA5HT$ID)

library(plyr)

str(SubjectInfo)

# 'data.frame':	72 obs. of  44 variables:
#   $ Barcode                             : chr  "B007375A" "B010169A" "B000014A" "B010842A" ...
# $ Subject.Number                      : int  5000 5313 2169 4087 5066 2950 4383 4619 4819 3711 ...
# $ Cohort                              : chr  "Cohort 11" "Cohort 13" "Dep Cohort 1" "Dep Cohort 6" ...
# $ Diagnosis                           : Factor w/ 3 levels "Control","BP",..: 1 3 1 2 1 3 2 3 1 2 ...
# $ Age                                 : int  77 42 18 51 47 45 40 34 79 59 ...
# $ Gender                              : Factor w/ 2 levels "M","F": 1 1 1 2 1 1 1 1 1 2 ...
# $ pH                                  : num  6.79 6.77 6.97 6.81 6.6 7.05 6.77 6.7 6.75 6.55 ...
# $ AFS                                 : int  0 0 0 0 0 0 0 0 0 0 ...
# $ Hours.Final                         : num  16.5 23.7 22 16.8 21 20 26.3 17.2 21 27 ...
# $ Slab.Format                         : chr  "SLAB" "SLAB" "SLAB" "SLAB" ...
# $ Slab.Number                         : int  1 1 1 1 1 1 1 1 1 1 ...
# $ Dissecton.Group                     : Factor w/ 13 levels "1","2","3","4",..: 1 1 1 1 1 1 2 2 2 2 ...
# $ ID                                  : chr  "1" "2" "3" "4" ...
# $ TTP.ID                              : chr  "TTP010001" "TTP010002" "TTP010003" "TTP010004" ...
# $ Block.Weight..g.                    : num  0.72 0.66 0.76 0.56 0.7 0.89 0.85 1.02 0.66 0.87 ...
# $ TZP.ID                              : chr  "TZP010001" "TZP010002" "TZP010003" "TZP010004" ...
# $ TZP_MBNI_Nanodrop_RNAConc..ng.uL.   : num  436 343 394 417 399 ...
# $ TZP_MBNI_Nanodrop_260.280           : num  1.96 2.01 1.99 1.97 2 1.99 2 2 2.02 2 ...
# $ TZP_MBNI_Nanodrop_260.230           : num  1.93 2.18 2.02 2.1 2.19 2.23 2.3 2.3 2.25 2.28 ...
# $ TZP_DSC_Nanodrop_RNAConc..ng.uL.    : num  562 354 451 449 435 ...
# $ TZP_DSC_Nanodrop_260.280            : num  2.14 1.92 2.03 2.03 2.05 2.05 2.05 2.06 2.05 2.06 ...
# $ TZP_DSC_Nanodrop_260.230            : num  1.9 2.06 2.01 2.13 2.22 2.27 2.29 2.28 2.22 2.3 ...
# $ TZP_BioAnalyzer_RIN                 : num  7.7 8.1 7.9 8 8.2 8.1 6.6 7.7 8.6 8 ...
# $ TZP_BioAnalyzer_rRNA.Ratio..28s.18s.: num  2.4 2.3 3.1 2 2.4 2.7 1.44 2.4 2.3 2.3 ...
# $ TZP_Average.RNAConc..ng.uL.         : num  499 349 422 433 417 ...
# $ TZP_Average.260.280                 : num  2.05 1.97 2.01 2 2.03 2.02 2.03 2.03 2.04 2.03 ...
# $ TZP_Average.260.230                 : num  1.92 2.12 2.02 2.12 2.21 2.25 2.3 2.29 2.24 2.29 ...
# $ TTP.ID.1                            : chr  "TTP010001" "TTP010002" "TTP010003" "TTP010004" ...
# $ Initial.Volume..uL.                 : int  720 660 760 560 700 890 850 1020 660 870 ...
# $ Final.Volume..uL.                   : int  620 560 660 460 600 790 750 920 560 770 ...
# $ TTP_MBNI_Nanodrop_RNAConc..ng.uL.   : num  528 398 452 523 463 ...
# $ TTP_MBNI_Nanodrop_260.280           : num  2 1.82 1.77 1.96 1.78 1.8 1.78 1.79 1.8 1.8 ...
# $ TTP_MBNI_Nanodrop_260.230           : num  1.87 2.02 1.99 1.99 1.9 2.04 2.24 1.94 1.69 1.89 ...
# $ TTP_DSC_Nanodrop_RNAConc..ng.uL.    : num  631 429 555 644 551 ...
# $ TTP_DSC_Nanodrop_260.280            : num  2.02 1.92 2.01 2.02 2.03 1.91 1.97 1.98 2.01 1.99 ...
# $ TTP_DSC_Nanodrop_260.230            : num  1.83 2.04 2.05 1.96 1.9 2.09 2.29 1.95 1.62 1.86 ...
# $ TTP_BioAnalyzer_RIN                 : num  7.4 7.8 7.7 7.7 8 7.9 7 7.2 8.2 7.5 ...
# $ TTP_BioAnalyzer_rRNA.Ratio..28s.18s.: num  2.2 2.2 2.8 2.1 2.4 2.5 1.9 2.3 2.3 2.3 ...
# $ TTP_Average.RNAConc..ng.uL.         : num  579 414 503 583 507 ...
# $ TTP_Average.260.280                 : num  2.01 1.87 1.89 1.99 1.91 ...
# $ TTP_Average.260.230                 : num  1.85 2.03 2.02 1.98 1.9 ...
# $ MissingPH                           : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ MissingExtractionData               : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ LowQualityRNA                       : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...

str(Decoder_GabaGluCards)
# 'data.frame':	144 obs. of  5 variables:
#   $ Subject.Number       : int  5000 5000 5313 5313 2169 2169 4087 4087 5066 5066 ...
# $ ID                   : chr  "1" "1" "2" "2" ...
# $ Folder               : chr  "Card 1.eds" "Card 2.eds" "Card 1.eds" "Card 2.eds" ...
# $ SampleNumber         : int  1 1 2 2 3 3 4 4 1 1 ...
# $ QC_AmplificationIssue: chr  "N" "N" "N" "N" ...

#Twice the size because there are two rows for each subject.

#Note: we later discovered that the folder information in the decoder wasn't quite right. It turned out to be irrelevant.


Decoder_GabaGluCards_w_SubjectInfo<-join(SubjectInfo, Decoder_GabaGluCards[,c(1:2,4:5)], by="Subject.Number", type="left", match="first")
str(Decoder_GabaGluCards_w_SubjectInfo)

# 'data.frame':	72 obs. of  47 variables:
#   $ Subject.Number                      : int  5000 5313 2169 4087 5066 2950 4383 4619 4819 3711 ...
# $ Barcode                             : chr  "B007375A" "B010169A" "B000014A" "B010842A" ...
# $ Cohort                              : chr  "Cohort 11" "Cohort 13" "Dep Cohort 1" "Dep Cohort 6" ...
# $ Diagnosis                           : Factor w/ 3 levels "Control","BP",..: 1 3 1 2 1 3 2 3 1 2 ...
# $ Age                                 : int  77 42 18 51 47 45 40 34 79 59 ...
# $ Gender                              : Factor w/ 2 levels "M","F": 1 1 1 2 1 1 1 1 1 2 ...
# $ pH                                  : num  6.79 6.77 6.97 6.81 6.6 7.05 6.77 6.7 6.75 6.55 ...
# $ AFS                                 : int  0 0 0 0 0 0 0 0 0 0 ...
# $ Hours.Final                         : num  16.5 23.7 22 16.8 21 20 26.3 17.2 21 27 ...
# $ Slab.Format                         : chr  "SLAB" "SLAB" "SLAB" "SLAB" ...
# $ Slab.Number                         : int  1 1 1 1 1 1 1 1 1 1 ...
# $ Dissecton.Group                     : Factor w/ 13 levels "1","2","3","4",..: 1 1 1 1 1 1 2 2 2 2 ...
# $ ID                                  : chr  "1" "2" "3" "4" ...
# $ TTP.ID                              : chr  "TTP010001" "TTP010002" "TTP010003" "TTP010004" ...
# $ Block.Weight..g.                    : num  0.72 0.66 0.76 0.56 0.7 0.89 0.85 1.02 0.66 0.87 ...
# $ TZP.ID                              : chr  "TZP010001" "TZP010002" "TZP010003" "TZP010004" ...
# $ TZP_MBNI_Nanodrop_RNAConc..ng.uL.   : num  436 343 394 417 399 ...
# $ TZP_MBNI_Nanodrop_260.280           : num  1.96 2.01 1.99 1.97 2 1.99 2 2 2.02 2 ...
# $ TZP_MBNI_Nanodrop_260.230           : num  1.93 2.18 2.02 2.1 2.19 2.23 2.3 2.3 2.25 2.28 ...
# $ TZP_DSC_Nanodrop_RNAConc..ng.uL.    : num  562 354 451 449 435 ...
# $ TZP_DSC_Nanodrop_260.280            : num  2.14 1.92 2.03 2.03 2.05 2.05 2.05 2.06 2.05 2.06 ...
# $ TZP_DSC_Nanodrop_260.230            : num  1.9 2.06 2.01 2.13 2.22 2.27 2.29 2.28 2.22 2.3 ...
# $ TZP_BioAnalyzer_RIN                 : num  7.7 8.1 7.9 8 8.2 8.1 6.6 7.7 8.6 8 ...
# $ TZP_BioAnalyzer_rRNA.Ratio..28s.18s.: num  2.4 2.3 3.1 2 2.4 2.7 1.44 2.4 2.3 2.3 ...
# $ TZP_Average.RNAConc..ng.uL.         : num  499 349 422 433 417 ...
# $ TZP_Average.260.280                 : num  2.05 1.97 2.01 2 2.03 2.02 2.03 2.03 2.04 2.03 ...
# $ TZP_Average.260.230                 : num  1.92 2.12 2.02 2.12 2.21 2.25 2.3 2.29 2.24 2.29 ...
# $ TTP.ID.1                            : chr  "TTP010001" "TTP010002" "TTP010003" "TTP010004" ...
# $ Initial.Volume..uL.                 : int  720 660 760 560 700 890 850 1020 660 870 ...
# $ Final.Volume..uL.                   : int  620 560 660 460 600 790 750 920 560 770 ...
# $ TTP_MBNI_Nanodrop_RNAConc..ng.uL.   : num  528 398 452 523 463 ...
# $ TTP_MBNI_Nanodrop_260.280           : num  2 1.82 1.77 1.96 1.78 1.8 1.78 1.79 1.8 1.8 ...
# $ TTP_MBNI_Nanodrop_260.230           : num  1.87 2.02 1.99 1.99 1.9 2.04 2.24 1.94 1.69 1.89 ...
# $ TTP_DSC_Nanodrop_RNAConc..ng.uL.    : num  631 429 555 644 551 ...
# $ TTP_DSC_Nanodrop_260.280            : num  2.02 1.92 2.01 2.02 2.03 1.91 1.97 1.98 2.01 1.99 ...
# $ TTP_DSC_Nanodrop_260.230            : num  1.83 2.04 2.05 1.96 1.9 2.09 2.29 1.95 1.62 1.86 ...
# $ TTP_BioAnalyzer_RIN                 : num  7.4 7.8 7.7 7.7 8 7.9 7 7.2 8.2 7.5 ...
# $ TTP_BioAnalyzer_rRNA.Ratio..28s.18s.: num  2.2 2.2 2.8 2.1 2.4 2.5 1.9 2.3 2.3 2.3 ...
# $ TTP_Average.RNAConc..ng.uL.         : num  579 414 503 583 507 ...
# $ TTP_Average.260.280                 : num  2.01 1.87 1.89 1.99 1.91 ...
# $ TTP_Average.260.230                 : num  1.85 2.03 2.02 1.98 1.9 ...
# $ MissingPH                           : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ MissingExtractionData               : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ LowQualityRNA                       : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ ID                                  : chr  "1" "2" "3" "4" ...
# $ SampleNumber                        : int  1 2 3 4 1 2 3 4 1 2 ...
# $ QC_AmplificationIssue               : chr  "N" "N" "N" "N" ...

write.csv(Decoder_GabaGluCards_w_SubjectInfo, "Decoder_GabaGluCards_w_SubjectInfo.csv")


Concatenated_GabaGlu_wSubjectInfo<-join(Concatenated_GabaGlu, Decoder_GabaGluCards_w_SubjectInfo, by="ID", type="left")
str(Concatenated_GabaGlu_wSubjectInfo)
# 'data.frame':	13824 obs. of  69 variables:
#   $ Well                                : chr  "A1" "A2" "A3" "A4" ...
# $ ID                                  : chr  "1" "1" "1" "1" ...
# $ Target.Name                         : chr  "ABAT-Hs00609436_m1" "ADCY7-Hs00936808_m1" "ADORA1-Hs00379752_m1" "ADORA2A-Hs00169123_m1" ...
# $ Amp.Score                           : num  1.28 1.25 1.14 1.23 1.23 ...
# $ Amp.Status                          : chr  "Amp" "Amp" "Amp" "Amp" ...
# $ Task                                : chr  "UNKNOWN" "UNKNOWN" "UNKNOWN" "UNKNOWN" ...
# $ Cq                                  : chr  "20.513" "25.734" "23.737" "27.270" ...
# $ Cq.Mean                             : chr  "20.513" "25.734" "23.737" "27.27" ...
# $ Cq.Standard.Deviation               : chr  "-" "-" "-" "-" ...
# $ Quantity                            : chr  "-" "-" "-" "-" ...
# $ Quantity.Mean                       : chr  "-" "-" "-" "-" ...
# $ Quantity.Standard.Deviation         : chr  "-" "-" "-" "-" ...
# $ Intercept                           : chr  "-" "-" "-" "-" ...
# $ R.Squared                           : chr  "-" "-" "-" "-" ...
# $ Slope                               : chr  "-" "-" "-" "-" ...
# $ Efficiency                          : chr  "-" "-" "-" "-" ...
# $ Auto.Threshold                      : chr  "true" "true" "true" "true" ...
# $ Threshold                           : num  0.183 0.161 0.09 0.175 0.133 0.193 0.14 0.106 0.195 0.136 ...
# $ Auto.Baseline                       : chr  "true" "true" "true" "true" ...
# $ Baseline.Start                      : num  3 3 3 3 3 3 3 3 3 3 ...
# $ Baseline.End                        : num  15 20 19 22 18 17 19 19 16 19 ...
# $ Omit                                : chr  "false" "false" "false" "false" ...
# $ X                                   : logi  NA NA NA NA NA NA ...
# $ Card                                : chr  "Card 1.eds" "Card 1.eds" "Card 1.eds" "Card 1.eds" ...
# $ Subject.Number                      : int  5000 5000 5000 5000 5000 5000 5000 5000 5000 5000 ...
# $ Barcode                             : chr  "B007375A" "B007375A" "B007375A" "B007375A" ...
# $ Cohort                              : chr  "Cohort 11" "Cohort 11" "Cohort 11" "Cohort 11" ...
# $ Diagnosis                           : Factor w/ 3 levels "Control","BP",..: 1 1 1 1 1 1 1 1 1 1 ...
# $ Age                                 : int  77 77 77 77 77 77 77 77 77 77 ...
# $ Gender                              : Factor w/ 2 levels "M","F": 1 1 1 1 1 1 1 1 1 1 ...
# $ pH                                  : num  6.79 6.79 6.79 6.79 6.79 6.79 6.79 6.79 6.79 6.79 ...
# $ AFS                                 : int  0 0 0 0 0 0 0 0 0 0 ...
# $ Hours.Final                         : num  16.5 16.5 16.5 16.5 16.5 16.5 16.5 16.5 16.5 16.5 ...
# $ Slab.Format                         : chr  "SLAB" "SLAB" "SLAB" "SLAB" ...
# $ Slab.Number                         : int  1 1 1 1 1 1 1 1 1 1 ...
# $ Dissecton.Group                     : Factor w/ 13 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...
# $ TTP.ID                              : chr  "TTP010001" "TTP010001" "TTP010001" "TTP010001" ...
# $ Block.Weight..g.                    : num  0.72 0.72 0.72 0.72 0.72 0.72 0.72 0.72 0.72 0.72 ...
# $ TZP.ID                              : chr  "TZP010001" "TZP010001" "TZP010001" "TZP010001" ...
# $ TZP_MBNI_Nanodrop_RNAConc..ng.uL.   : num  436 436 436 436 436 ...
# $ TZP_MBNI_Nanodrop_260.280           : num  1.96 1.96 1.96 1.96 1.96 1.96 1.96 1.96 1.96 1.96 ...
# $ TZP_MBNI_Nanodrop_260.230           : num  1.93 1.93 1.93 1.93 1.93 1.93 1.93 1.93 1.93 1.93 ...
# $ TZP_DSC_Nanodrop_RNAConc..ng.uL.    : num  562 562 562 562 562 ...
# $ TZP_DSC_Nanodrop_260.280            : num  2.14 2.14 2.14 2.14 2.14 2.14 2.14 2.14 2.14 2.14 ...
# $ TZP_DSC_Nanodrop_260.230            : num  1.9 1.9 1.9 1.9 1.9 1.9 1.9 1.9 1.9 1.9 ...
# $ TZP_BioAnalyzer_RIN                 : num  7.7 7.7 7.7 7.7 7.7 7.7 7.7 7.7 7.7 7.7 ...
# $ TZP_BioAnalyzer_rRNA.Ratio..28s.18s.: num  2.4 2.4 2.4 2.4 2.4 2.4 2.4 2.4 2.4 2.4 ...
# $ TZP_Average.RNAConc..ng.uL.         : num  499 499 499 499 499 ...
# $ TZP_Average.260.280                 : num  2.05 2.05 2.05 2.05 2.05 2.05 2.05 2.05 2.05 2.05 ...
# $ TZP_Average.260.230                 : num  1.92 1.92 1.92 1.92 1.92 1.92 1.92 1.92 1.92 1.92 ...
# $ TTP.ID.1                            : chr  "TTP010001" "TTP010001" "TTP010001" "TTP010001" ...
# $ Initial.Volume..uL.                 : int  720 720 720 720 720 720 720 720 720 720 ...
# $ Final.Volume..uL.                   : int  620 620 620 620 620 620 620 620 620 620 ...
# $ TTP_MBNI_Nanodrop_RNAConc..ng.uL.   : num  528 528 528 528 528 ...
# $ TTP_MBNI_Nanodrop_260.280           : num  2 2 2 2 2 2 2 2 2 2 ...
# $ TTP_MBNI_Nanodrop_260.230           : num  1.87 1.87 1.87 1.87 1.87 1.87 1.87 1.87 1.87 1.87 ...
# $ TTP_DSC_Nanodrop_RNAConc..ng.uL.    : num  631 631 631 631 631 ...
# $ TTP_DSC_Nanodrop_260.280            : num  2.02 2.02 2.02 2.02 2.02 2.02 2.02 2.02 2.02 2.02 ...
# $ TTP_DSC_Nanodrop_260.230            : num  1.83 1.83 1.83 1.83 1.83 1.83 1.83 1.83 1.83 1.83 ...
# $ TTP_BioAnalyzer_RIN                 : num  7.4 7.4 7.4 7.4 7.4 7.4 7.4 7.4 7.4 7.4 ...
# $ TTP_BioAnalyzer_rRNA.Ratio..28s.18s.: num  2.2 2.2 2.2 2.2 2.2 2.2 2.2 2.2 2.2 2.2 ...
# $ TTP_Average.RNAConc..ng.uL.         : num  579 579 579 579 579 ...
# $ TTP_Average.260.280                 : num  2.01 2.01 2.01 2.01 2.01 2.01 2.01 2.01 2.01 2.01 ...
# $ TTP_Average.260.230                 : num  1.85 1.85 1.85 1.85 1.85 1.85 1.85 1.85 1.85 1.85 ...
# $ MissingPH                           : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ MissingExtractionData               : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ LowQualityRNA                       : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ SampleNumber                        : int  1 1 1 1 1 1 1 1 1 1 ...
# $ QC_AmplificationIssue               : chr  "N" "N" "N" "N" ...

Decoder_DA5HTCards_w_SubjectInfo<-join(SubjectInfo, Decoder_DA5HTCards[,c(1:2,4:5)], by="Subject.Number", type="left", match="first")
str(Decoder_DA5HTCards_w_SubjectInfo)

# 'data.frame':	72 obs. of  47 variables:
#   $ Subject.Number                      : int  5000 5313 2169 4087 5066 2950 4383 4619 4819 3711 ...
# $ Barcode                             : chr  "B007375A" "B010169A" "B000014A" "B010842A" ...
# $ Cohort                              : chr  "Cohort 11" "Cohort 13" "Dep Cohort 1" "Dep Cohort 6" ...
# $ Diagnosis                           : Factor w/ 3 levels "Control","BP",..: 1 3 1 2 1 3 2 3 1 2 ...
# $ Age                                 : int  77 42 18 51 47 45 40 34 79 59 ...
# $ Gender                              : Factor w/ 2 levels "M","F": 1 1 1 2 1 1 1 1 1 2 ...
# $ pH                                  : num  6.79 6.77 6.97 6.81 6.6 7.05 6.77 6.7 6.75 6.55 ...
# $ AFS                                 : int  0 0 0 0 0 0 0 0 0 0 ...
# $ Hours.Final                         : num  16.5 23.7 22 16.8 21 20 26.3 17.2 21 27 ...
# $ Slab.Format                         : chr  "SLAB" "SLAB" "SLAB" "SLAB" ...
# $ Slab.Number                         : int  1 1 1 1 1 1 1 1 1 1 ...
# $ Dissecton.Group                     : Factor w/ 13 levels "1","2","3","4",..: 1 1 1 1 1 1 2 2 2 2 ...
# $ ID                                  : chr  "1" "2" "3" "4" ...
# $ TTP.ID                              : chr  "TTP010001" "TTP010002" "TTP010003" "TTP010004" ...
# $ Block.Weight..g.                    : num  0.72 0.66 0.76 0.56 0.7 0.89 0.85 1.02 0.66 0.87 ...
# $ TZP.ID                              : chr  "TZP010001" "TZP010002" "TZP010003" "TZP010004" ...
# $ TZP_MBNI_Nanodrop_RNAConc..ng.uL.   : num  436 343 394 417 399 ...
# $ TZP_MBNI_Nanodrop_260.280           : num  1.96 2.01 1.99 1.97 2 1.99 2 2 2.02 2 ...
# $ TZP_MBNI_Nanodrop_260.230           : num  1.93 2.18 2.02 2.1 2.19 2.23 2.3 2.3 2.25 2.28 ...
# $ TZP_DSC_Nanodrop_RNAConc..ng.uL.    : num  562 354 451 449 435 ...
# $ TZP_DSC_Nanodrop_260.280            : num  2.14 1.92 2.03 2.03 2.05 2.05 2.05 2.06 2.05 2.06 ...
# $ TZP_DSC_Nanodrop_260.230            : num  1.9 2.06 2.01 2.13 2.22 2.27 2.29 2.28 2.22 2.3 ...
# $ TZP_BioAnalyzer_RIN                 : num  7.7 8.1 7.9 8 8.2 8.1 6.6 7.7 8.6 8 ...
# $ TZP_BioAnalyzer_rRNA.Ratio..28s.18s.: num  2.4 2.3 3.1 2 2.4 2.7 1.44 2.4 2.3 2.3 ...
# $ TZP_Average.RNAConc..ng.uL.         : num  499 349 422 433 417 ...
# $ TZP_Average.260.280                 : num  2.05 1.97 2.01 2 2.03 2.02 2.03 2.03 2.04 2.03 ...
# $ TZP_Average.260.230                 : num  1.92 2.12 2.02 2.12 2.21 2.25 2.3 2.29 2.24 2.29 ...
# $ TTP.ID.1                            : chr  "TTP010001" "TTP010002" "TTP010003" "TTP010004" ...
# $ Initial.Volume..uL.                 : int  720 660 760 560 700 890 850 1020 660 870 ...
# $ Final.Volume..uL.                   : int  620 560 660 460 600 790 750 920 560 770 ...
# $ TTP_MBNI_Nanodrop_RNAConc..ng.uL.   : num  528 398 452 523 463 ...
# $ TTP_MBNI_Nanodrop_260.280           : num  2 1.82 1.77 1.96 1.78 1.8 1.78 1.79 1.8 1.8 ...
# $ TTP_MBNI_Nanodrop_260.230           : num  1.87 2.02 1.99 1.99 1.9 2.04 2.24 1.94 1.69 1.89 ...
# $ TTP_DSC_Nanodrop_RNAConc..ng.uL.    : num  631 429 555 644 551 ...
# $ TTP_DSC_Nanodrop_260.280            : num  2.02 1.92 2.01 2.02 2.03 1.91 1.97 1.98 2.01 1.99 ...
# $ TTP_DSC_Nanodrop_260.230            : num  1.83 2.04 2.05 1.96 1.9 2.09 2.29 1.95 1.62 1.86 ...
# $ TTP_BioAnalyzer_RIN                 : num  7.4 7.8 7.7 7.7 8 7.9 7 7.2 8.2 7.5 ...
# $ TTP_BioAnalyzer_rRNA.Ratio..28s.18s.: num  2.2 2.2 2.8 2.1 2.4 2.5 1.9 2.3 2.3 2.3 ...
# $ TTP_Average.RNAConc..ng.uL.         : num  579 414 503 583 507 ...
# $ TTP_Average.260.280                 : num  2.01 1.87 1.89 1.99 1.91 ...
# $ TTP_Average.260.230                 : num  1.85 2.03 2.02 1.98 1.9 ...
# $ MissingPH                           : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ MissingExtractionData               : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ LowQualityRNA                       : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ ID                                  : chr  "1" "2" "3" "4" ...
# $ SampleNumber                        : logi  NA NA NA NA NA NA ...
# $ QC_AmplificationIssue               : chr  "N" "N" "N" "N" ...

write.csv(Decoder_DA5HTCards_w_SubjectInfo, "Decoder_DA5HTCards_w_SubjectInfo.csv")


Concatenated_DA5HT_wSubjectInfo<-join(Concatenated_DA5HT, Decoder_DA5HTCards_w_SubjectInfo, by="ID", type="left")
str(Concatenated_DA5HT_wSubjectInfo)

# 'data.frame':	7680 obs. of  69 variables:
#   $ Well                                : chr  "A1" "A2" "A3" "A4" ...
# $ ID                                  : chr  "1" "1" "1" "1" ...
# $ Target.Name                         : chr  "ADRB1-Hs02330048_s1" "ADRB2-Hs00240532_s1" "COMT-Hs00241349_m1" "DBH-Hs01089840_m1" ...
# $ Amp.Score                           : num  1.25 1.38 1.09 1.31 1.42 ...
# $ Amp.Status                          : chr  "Amp" "Amp" "Amp" "Amp" ...
# $ Task                                : chr  "UNKNOWN" "UNKNOWN" "UNKNOWN" "UNKNOWN" ...
# $ Cq                                  : chr  "24.245" "25.087" "24.579" "27.823" ...
# $ Cq.Mean                             : chr  "24.245" "25.087" "24.579" "27.823" ...
# $ Cq.Standard.Deviation               : chr  "-" "-" "-" "-" ...
# $ Quantity                            : chr  "-" "-" "-" "-" ...
# $ Quantity.Mean                       : chr  "-" "-" "-" "-" ...
# $ Quantity.Standard.Deviation         : chr  "-" "-" "-" "-" ...
# $ Intercept                           : chr  "-" "-" "-" "-" ...
# $ R.Squared                           : chr  "-" "-" "-" "-" ...
# $ Slope                               : chr  "-" "-" "-" "-" ...
# $ Efficiency                          : chr  "-" "-" "-" "-" ...
# $ Auto.Threshold                      : chr  "true" "true" "true" "true" ...
# $ Threshold                           : num  0.163 0.239 0.048 0.167 0.24 0.202 0.227 0.194 0.184 0.228 ...
# $ Auto.Baseline                       : chr  "true" "true" "true" "true" ...
# $ Baseline.Start                      : num  3 3 3 3 3 3 3 3 3 3 ...
# $ Baseline.End                        : num  19 20 21 23 27 20 23 27 27 21 ...
# $ Omit                                : chr  "false" "false" "false" "false" ...
# $ X                                   : logi  NA NA NA NA NA NA ...
# $ Card                                : chr  "Card 39.eds" "Card 39.eds" "Card 39.eds" "Card 39.eds" ...
# $ Subject.Number                      : int  5000 5000 5000 5000 5000 5000 5000 5000 5000 5000 ...
# $ Barcode                             : chr  "B007375A" "B007375A" "B007375A" "B007375A" ...
# $ Cohort                              : chr  "Cohort 11" "Cohort 11" "Cohort 11" "Cohort 11" ...
# $ Diagnosis                           : Factor w/ 3 levels "Control","BP",..: 1 1 1 1 1 1 1 1 1 1 ...
# $ Age                                 : int  77 77 77 77 77 77 77 77 77 77 ...
# $ Gender                              : Factor w/ 2 levels "M","F": 1 1 1 1 1 1 1 1 1 1 ...
# $ pH                                  : num  6.79 6.79 6.79 6.79 6.79 6.79 6.79 6.79 6.79 6.79 ...
# $ AFS                                 : int  0 0 0 0 0 0 0 0 0 0 ...
# $ Hours.Final                         : num  16.5 16.5 16.5 16.5 16.5 16.5 16.5 16.5 16.5 16.5 ...
# $ Slab.Format                         : chr  "SLAB" "SLAB" "SLAB" "SLAB" ...
# $ Slab.Number                         : int  1 1 1 1 1 1 1 1 1 1 ...
# $ Dissecton.Group                     : Factor w/ 13 levels "1","2","3","4",..: 1 1 1 1 1 1 1 1 1 1 ...
# $ TTP.ID                              : chr  "TTP010001" "TTP010001" "TTP010001" "TTP010001" ...
# $ Block.Weight..g.                    : num  0.72 0.72 0.72 0.72 0.72 0.72 0.72 0.72 0.72 0.72 ...
# $ TZP.ID                              : chr  "TZP010001" "TZP010001" "TZP010001" "TZP010001" ...
# $ TZP_MBNI_Nanodrop_RNAConc..ng.uL.   : num  436 436 436 436 436 ...
# $ TZP_MBNI_Nanodrop_260.280           : num  1.96 1.96 1.96 1.96 1.96 1.96 1.96 1.96 1.96 1.96 ...
# $ TZP_MBNI_Nanodrop_260.230           : num  1.93 1.93 1.93 1.93 1.93 1.93 1.93 1.93 1.93 1.93 ...
# $ TZP_DSC_Nanodrop_RNAConc..ng.uL.    : num  562 562 562 562 562 ...
# $ TZP_DSC_Nanodrop_260.280            : num  2.14 2.14 2.14 2.14 2.14 2.14 2.14 2.14 2.14 2.14 ...
# $ TZP_DSC_Nanodrop_260.230            : num  1.9 1.9 1.9 1.9 1.9 1.9 1.9 1.9 1.9 1.9 ...
# $ TZP_BioAnalyzer_RIN                 : num  7.7 7.7 7.7 7.7 7.7 7.7 7.7 7.7 7.7 7.7 ...
# $ TZP_BioAnalyzer_rRNA.Ratio..28s.18s.: num  2.4 2.4 2.4 2.4 2.4 2.4 2.4 2.4 2.4 2.4 ...
# $ TZP_Average.RNAConc..ng.uL.         : num  499 499 499 499 499 ...
# $ TZP_Average.260.280                 : num  2.05 2.05 2.05 2.05 2.05 2.05 2.05 2.05 2.05 2.05 ...
# $ TZP_Average.260.230                 : num  1.92 1.92 1.92 1.92 1.92 1.92 1.92 1.92 1.92 1.92 ...
# $ TTP.ID.1                            : chr  "TTP010001" "TTP010001" "TTP010001" "TTP010001" ...
# $ Initial.Volume..uL.                 : int  720 720 720 720 720 720 720 720 720 720 ...
# $ Final.Volume..uL.                   : int  620 620 620 620 620 620 620 620 620 620 ...
# $ TTP_MBNI_Nanodrop_RNAConc..ng.uL.   : num  528 528 528 528 528 ...
# $ TTP_MBNI_Nanodrop_260.280           : num  2 2 2 2 2 2 2 2 2 2 ...
# $ TTP_MBNI_Nanodrop_260.230           : num  1.87 1.87 1.87 1.87 1.87 1.87 1.87 1.87 1.87 1.87 ...
# $ TTP_DSC_Nanodrop_RNAConc..ng.uL.    : num  631 631 631 631 631 ...
# $ TTP_DSC_Nanodrop_260.280            : num  2.02 2.02 2.02 2.02 2.02 2.02 2.02 2.02 2.02 2.02 ...
# $ TTP_DSC_Nanodrop_260.230            : num  1.83 1.83 1.83 1.83 1.83 1.83 1.83 1.83 1.83 1.83 ...
# $ TTP_BioAnalyzer_RIN                 : num  7.4 7.4 7.4 7.4 7.4 7.4 7.4 7.4 7.4 7.4 ...
# $ TTP_BioAnalyzer_rRNA.Ratio..28s.18s.: num  2.2 2.2 2.2 2.2 2.2 2.2 2.2 2.2 2.2 2.2 ...
# $ TTP_Average.RNAConc..ng.uL.         : num  579 579 579 579 579 ...
# $ TTP_Average.260.280                 : num  2.01 2.01 2.01 2.01 2.01 2.01 2.01 2.01 2.01 2.01 ...
# $ TTP_Average.260.230                 : num  1.85 1.85 1.85 1.85 1.85 1.85 1.85 1.85 1.85 1.85 ...
# $ MissingPH                           : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ MissingExtractionData               : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ LowQualityRNA                       : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
# $ SampleNumber                        : logi  NA NA NA NA NA NA ...
# $ QC_AmplificationIssue               : chr  "N" "N" "N" "N" ...


########################


#Identifying "Housekeeping Genes":

#We need to split the target name column (e.g., "ABAT-Hs00609436_m1") so that the official Gene Symbol is extracted

Temp_delim<- data.frame(do.call('rbind', strsplit(as.character(Concatenated_GabaGlu_wSubjectInfo$Target.Name),'-',fixed=TRUE)))
str(Temp_delim)

# 'data.frame':	13824 obs. of  2 variables:
#   $ X1: Factor w/ 96 levels "18S","ABAT","ACTB",..: 2 4 5 6 7 93 73 10 11 12 ...
# $ X2: Factor w/ 96 levels "Hs00161045_m1",..: 50 62 43 11 45 39 1 87 85 72 ...

Concatenated_GabaGlu_wSubjectInfo$GeneSymbol<-as.character(Temp_delim$X1)
str(Concatenated_GabaGlu_wSubjectInfo)

rm(Temp_delim)

Temp_delim<- data.frame(do.call('rbind', strsplit(as.character(Concatenated_DA5HT_wSubjectInfo$Target.Name),'-',fixed=TRUE)))
str(Temp_delim)
# 
# 'data.frame':	7680 obs. of  2 variables:
#   $ X1: Factor w/ 48 levels "ADRB1","ADRB2",..: 1 2 5 6 7 8 9 10 11 12 ...
# $ X2: Factor w/ 48 levels "Hs00165140_m1",..: 40 15 16 36 37 19 17 23 26 22 ...

Concatenated_DA5HT_wSubjectInfo$GeneSymbol<-as.character(Temp_delim$X1)
str(Concatenated_GabaGlu_wSubjectInfo)


#We need to use the housekeeping genes list to identify which of the official gene symbols are "housekeeping genes"

Concatenated_GabaGlu_wSubjectInfo$GeneSymbol%in%HousekeepingGenes[,1]

length(Concatenated_GabaGlu_wSubjectInfo$GeneSymbol%in%HousekeepingGenes[,1])
#[1] 13824

sum(Concatenated_GabaGlu_wSubjectInfo$GeneSymbol%in%HousekeepingGenes[,1])
#[1] 1728

Concatenated_GabaGlu_wSubjectInfo[Concatenated_GabaGlu_wSubjectInfo$GeneSymbol%in%HousekeepingGenes[,1],]
#Excellent - looks correct.

Concatenated_GabaGlu_wSubjectInfo$GeneSymbol[Concatenated_GabaGlu_wSubjectInfo$GeneSymbol%in%HousekeepingGenes[,1]]
#[1] "18S"   "HPRT1" "GUSB"  "ACTB"  "B2M"   "HMBS"  "IPO8"  "PGK1"  "RPLP0" "TBP"   "TFRC"  "UBC" 

#Adding a T/F column for whether a gene is a housekeeping gene:
Concatenated_GabaGlu_wSubjectInfo$Housekeeping<-Concatenated_GabaGlu_wSubjectInfo$GeneSymbol%in%HousekeepingGenes[,1]
str(Concatenated_GabaGlu_wSubjectInfo)

Concatenated_GabaGlu_wSubjectInfo$Cq[Concatenated_GabaGlu_wSubjectInfo$Cq=="Undetermined"]<-NA
Concatenated_GabaGlu_wSubjectInfo$Cq.Mean[Concatenated_GabaGlu_wSubjectInfo$Cq.Mean=="Undetermined"]<-NA

Concatenated_GabaGlu_wSubjectInfo$Cq[Concatenated_GabaGlu_wSubjectInfo$Cq=="No Amp"]<-NA
Concatenated_GabaGlu_wSubjectInfo$Cq.Mean[Concatenated_GabaGlu_wSubjectInfo$Cq.Mean=="No Amp"]<-NA

Concatenated_GabaGlu_wSubjectInfo$Cq<-as.numeric(Concatenated_GabaGlu_wSubjectInfo$Cq)
Concatenated_GabaGlu_wSubjectInfo$Cq.Mean<-as.numeric(Concatenated_GabaGlu_wSubjectInfo$Cq.Mean)

# Warning message:
#   NAs introduced by coercion 

setwd("~/Documents/Microarray Gen/FrontalPole/Sample_MetaData")

str(Concatenated_GabaGlu_wSubjectInfo)
write.csv(Concatenated_GabaGlu_wSubjectInfo, "Concatenated_GabaGlu_wSubjectInfo.csv")

Concatenated_DA5HT_wSubjectInfo$GeneSymbol[Concatenated_DA5HT_wSubjectInfo$GeneSymbol%in%HousekeepingGenes[,1]]
# [1] "GAPDH"   "HPRT1"   "GUSB"    "B2M"     "IPO8"    "TFRC"    "YWHAZ"   "PPIA"    "POLR2A"  "CASC3"   "GADD45A" "PUM1"   
# [13] "PSMC4"   "EMC7"    "GPI"     "RAB7A"   "REEP5" 

Concatenated_DA5HT_wSubjectInfo$Housekeeping<-Concatenated_DA5HT_wSubjectInfo$GeneSymbol%in%HousekeepingGenes[,1]

Concatenated_DA5HT_wSubjectInfo$Cq[Concatenated_DA5HT_wSubjectInfo$Cq=="Undetermined"]<-NA
Concatenated_DA5HT_wSubjectInfo$Cq.Mean[Concatenated_DA5HT_wSubjectInfo$Cq.Mean=="Undetermined"]<-NA

Concatenated_DA5HT_wSubjectInfo$Cq[Concatenated_DA5HT_wSubjectInfo$Cq=="No Amp"]<-NA
Concatenated_DA5HT_wSubjectInfo$Cq.Mean[Concatenated_DA5HT_wSubjectInfo$Cq.Mean=="No Amp"]<-NA

Concatenated_DA5HT_wSubjectInfo$Cq<-as.numeric(Concatenated_DA5HT_wSubjectInfo$Cq)
Concatenated_DA5HT_wSubjectInfo$Cq.Mean<-as.numeric(Concatenated_DA5HT_wSubjectInfo$Cq.Mean)

# Warning message:
#   NAs introduced by coercion

write.csv(Concatenated_DA5HT_wSubjectInfo, "Concatenated_DA5HT_wSubjectInfo.csv")


#################################################

#Basic QC:

#QC 1. Which samples have already been tagged as having amplification issues?

table(Decoder_GabaGluCards$QC_AmplificationIssue)
# N   Y 
# 142   2

Decoder_GabaGluCards[Decoder_GabaGluCards$QC_AmplificationIssue=="Y",]

# Subject.Number ID      Folder SampleNumber QC_AmplificationIssue
# 52           4301 27 Card 14.eds            2                     Y
# 69           4359 38 Card 17.eds            3                     Y


table(Decoder_DA5HTCards$QC_AmplificationIssue)
# N   Y 
# 142   2 

Decoder_DA5HTCards[Decoder_DA5HTCards$QC_AmplificationIssue=="Y",]

# Subject.Number ID Folder SampleNumber QC_AmplificationIssue
# 52           4301 27     NA           NA                     Y
# 69           4359 38     NA           NA                     Y


#QC 2. Which samples have a lot of "undetermined" or "no amp" Cq values?

sum(is.na(Concatenated_GabaGlu_wSubjectInfo$Cq))
#[1] 322

#Percent of measurements NA
322/length(Concatenated_GabaGlu_wSubjectInfo$Cq)

table(Concatenated_GabaGlu_wSubjectInfo$ID, is.na(Concatenated_GabaGlu_wSubjectInfo$Cq))

# FALSE TRUE
# 1    189    3
# 10   191    1
# 12   189    3
# 13   189    3
# 14   191    1
# 15   191    1
# 16   191    1
# 17   189    3
# 18   191    1
# 19   188    4
# 2    188    4
# 20   190    2
# 21   190    2
# 22   190    2
# 23   190    2
# 24   191    1
# 25   190    2
# 26   189    3
# 27    96   96
# 28   190    2
# 29   188    4
# 3    190    2
# 30   190    2
# 31   191    1
# 32   190    2
# 33   188    4
# 34   189    3
# 37   191    1
# 38    98   94
# 39   191    1
# 4    189    3
# 40   189    3
# 41   191    1
# 42   190    2
# 43   190    2
# 44   190    2
# 45   189    3
# 46   190    2
# 47   190    2
# 48   188    4
# 49   190    2
# 5    190    2
# 50   192    0
# 51   191    1
# 52   190    2
# 53   190    2
# 54   192    0
# 55   190    2
# 56   190    2
# 57   192    0
# 58   190    2
# 59   192    0
# 6    189    3
# 60   191    1
# 61   191    1
# 62   190    2
# 63   191    1
# 64   190    2
# 65   192    0
# 66   192    0
# 67   190    2
# 68   190    2
# 69   191    1
# 7    189    3
# 70   189    3
# 71   191    1
# 72   191    1
# 73   190    2
# 74   191    1
# 75   189    3
# 8    190    2
# 9    191    1

#The exact same samples have really high Cq NA counts

#NAs that aren't from the two bad samples:
322-94-96
#[1] 132
length(Concatenated_GabaGlu_wSubjectInfo$Cq)-96-96
#[1] 13632
132/13632
#[1] 0.009683099

setwd("~/Documents/Microarray Gen/FrontalPole/Output")

write.csv(table(Concatenated_GabaGlu_wSubjectInfo$ID, is.na(Concatenated_GabaGlu_wSubjectInfo$Cq)), "GabaGlu_Table_IDvsNAforCq.csv")


sum(is.na(Concatenated_DA5HT_wSubjectInfo$Cq))
#[1] 53
#The DA5HT data doesn't have as many bad measurements

length(Concatenated_DA5HT_wSubjectInfo$Cq)
#[1] 7680

53/7680
#[1] 0.006901042
#Less than 1% missing values

table(Concatenated_DA5HT_wSubjectInfo$ID, is.na(Concatenated_DA5HT_wSubjectInfo$Cq))

# FALSE TRUE
# 1    192    0
# 10    96    0
# 12    94    2
# 13    96    0
# 14    96    0
# 15    96    0
# 16    95    1
# 17    96    0
# 18   190    2
# 19    96    0
# 2     95    1
# 20    96    0
# 21    96    0
# 22   191    1
# 23    96    0
# 24    95    1
# 25    94    2
# 26    96    0
# 27    96    0
# 28    96    0
# 29    96    0
# 3     95    1
# 30    96    0
# 31   192    0
# 32    96    0
# 33    95    1
# 34    95    1
# 37    95    1
# 38    95    1
# 39    95    1
# 4     95    1
# 40    95    1
# 41   189    3
# 42    94    2
# 43    92    4
# 44    95    1
# 45    96    0
# 46   191    1
# 47    96    0
# 48    95    1
# 49    96    0
# 5     96    0
# 50    96    0
# 51    96    0
# 52    96    0
# 53    96    0
# 54    96    0
# 55    96    0
# 56    96    0
# 57    95    1
# 58   191    1
# 59    95    1
# 6     95    1
# 60    96    0
# 61   191    1
# 62    96    0
# 63    96    0
# 64    96    0
# 65    96    0
# 66    94    2
# 67    95    1
# 68    94    2
# 69    95    1
# 7     95    1
# 70    95    1
# 71    96    0
# 72    95    1
# 73    94    2
# 74    95    1
# 75    95    1
# 8     93    3
# 9     94    2

#Using this metric, none of the samples are completely bad for the DA5HT run.



#QC 3. Which samples have a lot of "omit" values?

table(Concatenated_GabaGlu_wSubjectInfo$Omit)
#false 
#13824 

table(Concatenated_DA5HT_wSubjectInfo$Omit)
#false 
#7680

#Well that's handy...

str(Concatenated_GabaGlu_wSubjectInfo)


#############################################
